<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>
        <record model='ir.ui.view' id='sale_order_view_form'>
        	<field name='name'>sale_order_view_form</field>
        	<field name='model'>sale.order</field>
        	<field name='inherit_id' ref="sale.view_order_form"/>
        	<field name='arch' type='xml'>
                <xpath expr="//field[@name='state']" position="replace">
                    <field name="state" widget="statusbar" statusbar_visible="draft,sent,sale,closed,done"/>
                </xpath>
                <xpath expr="//button[@name='action_cancel']" position="replace">
                    <button name="action_cancel" groups="sale_order_state_change.group_cancel_sale_order" states="draft,sent,sale,done" type="object" string="Cancel"/>
                </xpath>
                <xpath expr="//field[@name='state']" position="before">
                    <button name="action_closed" groups="sale_order_state_change.group_close_sale_order" states="draft,sent,sale,done" type="object" string="Closed" confirm="If you select the Cancel MO field, Are you sure you want to CANCEL all MO's of the Sale Order?"/>
                </xpath>                
                <xpath expr="//sheet/notebook//field[@name='order_line']" position="attributes">
                    <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel','closed'))]}</attribute>                    
                </xpath>
                <xpath expr="//field[@name='order_line']/form//field[@name='state']" position="replace">
                    <field name="state" invisible="1"/>
                </xpath>
                <xpath expr="//field[@name='company_id']" position="after">
                    <field name="closing_reason" />
                    <field name="cancel_mo" groups="sale_order_state_change.group_cancel_mo_sale_order"/>
                </xpath>
                <xpath expr="//field[@name='order_line']/tree//field[@name='price_subtotal']" position="after">
                    <field name="state" string="Estatus"/>
                    <!--button name="action_closed_line" groups="sale_order_state_change.group_close_sale_order_line" states="sale,done" type="object" confirm="Â¿Desea cerrar esta Linea de Venta?" icon="gtk-cancel" help="Cancelar Linea de Venta"/-->
                </xpath>
        	</field>
        </record>

        <record model='ir.ui.view' id='view_order_tree'>
            <field name='name'>view.order.tree</field>
            <field name='model'>sale.order</field>
            <field name='inherit_id' ref="sale.view_order_tree"/>
            <field name='arch' type='xml'>
                <xpath expr="//tree" position="attributes">
                    <attribute name="decoration-danger">state=='sale'</attribute>
                </xpath>
            </field>
        </record>
    </data>
</openerp>
